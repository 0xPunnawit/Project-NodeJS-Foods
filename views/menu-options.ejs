<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/menu-options.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <title>
    <%= title %>
  </title>
</head>

<body data-restaurant-id="<%= restaurant ? restaurant.restaurant_id : '' %>">

  <%- include('./partials/navbar') %>
  <br>
    <div class="container d-flex justify-content-center align-items-center vh-100">
      <div class="card p-4 mt-5" style="max-width: 400px;">
        <h3 class="card-title text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</h3>
        <form action="/menu/<%= menuItemId %>/order" method="POST">
          <% if (options.length> 0) { %>
            <div class="form-group">
              <% options.forEach(option=> { %>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="menuOption"
                    id="option-<%= option.menu_option_id %>" value="<%= option.name %>" <%=option.availability==='‡πÑ‡∏°‡πà‡∏°‡∏µ'
                    ? 'disabled' : '' %>
                  required>
                  <label class="form-check-label" for="option-<%= option.menu_option_id %>">
                    <span>
                      <%= option.name %>
                    </span>
                    <span class="badge <%= option.availability === '‡πÑ‡∏°‡πà‡∏°‡∏µ' ? 'bg-danger' : 'bg-success' %> text-white">
                      <%= option.availability==='‡πÑ‡∏°‡πà‡∏°‡∏µ' ? '‡∏´‡∏°‡∏î' : option.price_adjustment + ' ‡∏ö‡∏≤‡∏ó' %>
                    </span>
                  </label>
                </div>
                <% }) %>
            </div>
            <button type="submit" class="btn btn-primary w-100 mt-4 py-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
            <button type="button" class="btn btn-success w-100 mt-2 py-2" onclick="addToCart('<%= menuItemId %>')">üõí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
            <button type="button" class="btn btn-warning w-100 mt-2 py-2"
              onclick="window.history.back()">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            <% } else { %>
              <p class="text-center text-muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ</p>
              <% } %>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>

      function addToCart(menu_item_id) {
        let option = document.querySelector('input[name="menuOption"]:checked');
        let quantity = 1; // ‡πÉ‡∏´‡πâ default ‡πÄ‡∏õ‡πá‡∏ô 1 ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
  
        if (!option) {
            Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π!", "", "warning");
            return;
        }
  
        $.post("/cart/add", { menu_item_id, option_name: option.value, quantity }, function(response) {
            if (response.success) {
                Swal.fire({
                    icon: "success",
                    title: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤!",
                    text: "‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß",
                    showConfirmButton: true,
                    confirmButtonText: "üõçÔ∏è ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤",
                    showCancelButton: true,
                    cancelButtonText: "üõí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°"
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = "/cart";
                    }
                });
            } else {
                Swal.fire("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!", response.message, "error");
            }
        });
    }


      document.addEventListener("DOMContentLoaded", () => {
        const restaurantId = "<%= restaurant.restaurant_id %>";

        function checkRestaurantStatus() {
          $.ajax({
            url: `/api/check-restaurant-status/${restaurantId}`,
            method: "GET",
            success: function (data) {
              if (data.isClosed) {
                Swal.fire({
                  icon: "warning",
                  title: "‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß",
                  text: "‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô",
                  confirmButtonText: "‡∏ï‡∏Å‡∏•‡∏á",
                  allowOutsideClick: false, // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î Popup ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏î‡∏ï‡∏Å‡∏•‡∏á
                  timer: 2500  // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏Ñ‡πà 2.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß Redirect ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                }).then(() => {
                  window.location.href = "/restaurant"; // Redirect ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏î "‡∏ï‡∏Å‡∏•‡∏á"
                });
              }
            },
            error: function () {
              console.error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ");
            }
          });
        }

        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
        checkRestaurantStatus();

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
        setInterval(checkRestaurantStatus, 2000);
      });
    </script>
    


</body>

</html>